# تخصيص نص خطاب القبول

## نظرة عامة
تم إضافة إمكانية تعديل نص خطاب القبول من صفحة إعدادات الموقع، مما يتيح للأدمن تخصيص المحتوى حسب احتياجات المجلة.

---

## الميزات

### ✅ تخصيص كامل للنص
- تعديل النص الأساسي لخطاب القبول
- دعم النصوص الطويلة والفقرات المتعددة
- نص افتراضي احترافي في حالة عدم التخصيص

### ✅ واجهة سهلة
- محرر نصوص كبير (12 سطر)
- Placeholder توضيحي
- نصائح وإرشادات
- حفظ فوري مع باقي الإعدادات

### ✅ مرونة في الاستخدام
- إذا تركت الحقل فارغاً → يستخدم النص الافتراضي
- إذا أضفت نصاً مخصصاً → يظهر في جميع خطابات القبول
- تحويل تلقائي للنص إلى فقرات HTML

---

## التغييرات التقنية

### Backend

#### 1. Entity
**الملف**: `apps/backend/src/database/entities/site-settings.entity.ts`

```typescript
@Column({ type: 'text', nullable: true })
acceptance_letter_content!: string;
```

#### 2. DTO
**الملف**: `apps/backend/src/modules/site-settings/dto/update-site-settings.dto.ts`

```typescript
@IsOptional()
@IsString()
acceptance_letter_content?: string;
```

#### 3. PDF Generator
**الملف**: `apps/backend/src/modules/pdf/pdf-generator.service.ts`

```typescript
private generateLetterContent(siteSettings: SiteSettings): string {
  // استخدام النص المخصص إذا كان موجوداً
  if (siteSettings.acceptance_letter_content && siteSettings.acceptance_letter_content.trim()) {
    const paragraphs = siteSettings.acceptance_letter_content
      .split('\n')
      .filter(p => p.trim())
      .map(p => `<p>${p.trim()}</p>`)
      .join('\n');
    return paragraphs;
  }
  
  // النص الافتراضي
  return `
    <p>قد تم قبوله للنشر في مجلتنا بعد مراجعته من قبل المحكمين المختصين واستيفائه لجميع المعايير العلمية والأكاديمية المطلوبة.</p>
    <p>نتقدم لكم بأحر التهاني على هذا الإنجاز العلمي المتميز، ونتطلع إلى المزيد من التعاون العلمي المثمر معكم.</p>
    <p>وتفضلوا بقبول فائق الاحترام والتقدير،</p>`;
}
```

#### 4. Migration
**الملف**: `apps/backend/src/database/migrations/1730910000000-AddAcceptanceLetterContentToSiteSettings.ts`

```bash
cd apps/backend
npm run migration:run
```

أو SQL مباشر:
```sql
ALTER TABLE site_settings ADD COLUMN IF NOT EXISTS acceptance_letter_content TEXT;
```

### Frontend

#### 1. Types
**الملف**: `apps/frontend/src/services/site-settings.service.ts`

```typescript
export interface SiteSettings {
  // ... existing fields
  acceptance_letter_content?: string;
}

export interface UpdateSiteSettingsDto {
  // ... existing fields
  acceptance_letter_content?: string;
}
```

#### 2. Settings Page
**الملف**: `apps/frontend/src/pages/dashboard/admin/SiteSettingsPage.tsx`

قسم جديد بعد "رسوم التقديم":
- عنوان: "نص خطاب القبول"
- محرر نصوص كبير (12 سطر)
- Placeholder مع النص الافتراضي
- نصائح وإرشادات

---

## كيفية الاستخدام

### 1. تحديث قاعدة البيانات

```bash
cd apps/backend
npm run migration:run
```

أو استخدم SQL مباشرة:
```sql
ALTER TABLE site_settings ADD COLUMN IF NOT EXISTS acceptance_letter_content TEXT;
```

### 2. تخصيص النص من لوحة التحكم

1. سجل دخول كـ **Admin**
2. اذهب إلى **إعدادات الموقع**
3. ابحث عن قسم **"نص خطاب القبول"**
4. اكتب النص المخصص في المحرر

**مثال على نص مخصص:**
```
قد تم قبوله للنشر في مجلتنا العلمية المحكمة بعد مراجعته من قبل لجنة التحكيم المتخصصة.

نهنئكم على هذا الإنجاز الأكاديمي الرائع، ونتمنى لكم المزيد من التقدم والنجاح في مسيرتكم العلمية.

مع أطيب التحيات والتقدير،
```

5. احفظ التغييرات

### 3. التحقق من النتيجة

1. اذهب إلى **إدارة الأبحاث**
2. اختر بحثاً مقبولاً
3. اضغط على **"تحميل خطاب القبول"**
4. تحقق من ظهور النص المخصص في الخطاب

---

## النص الافتراضي

عند تشغيل Migration أو إنشاء إعدادات جديدة، سيتم تعيين النص الافتراضي تلقائياً:

**النص الافتراضي المحفوظ في قاعدة البيانات:**

```
قد تم قبوله للنشر في مجلتنا بعد مراجعته من قبل المحكمين المختصين واستيفائه لجميع المعايير العلمية والأكاديمية المطلوبة.

نتقدم لكم بأحر التهاني على هذا الإنجاز العلمي المتميز، ونتطلع إلى المزيد من التعاون العلمي المثمر معكم.

وتفضلوا بقبول فائق الاحترام والتقدير،
```

### ملاحظات مهمة:
- ✅ **يتم حفظ النص الافتراضي تلقائياً** عند تشغيل Migration
- ✅ **يظهر النص في صفحة الإعدادات** في صندوق أزرق للمعاينة
- ✅ **يمكنك تعديله في أي وقت** من صفحة الإعدادات
- ✅ **إذا حذفت النص وحفظت** → سيستخدم النظام النص الافتراضي من الكود

---

## نصائح للكتابة

### ✅ افعل:
- استخدم لغة رسمية ومهنية
- اكتب فقرات واضحة ومنظمة
- اذكر التهنئة والتقدير
- استخدم أسلوب محترم ولائق

### ❌ لا تفعل:
- لا تستخدم لغة عامية
- لا تكتب نصاً طويلاً جداً (3-4 فقرات كافية)
- لا تنسَ علامات الترقيم
- لا تستخدم HTML tags (سيتم إضافتها تلقائياً)

---

## أمثلة للنصوص المخصصة

### مثال 1: نص رسمي تقليدي
```
قد تم قبول بحثكم للنشر في مجلتنا العلمية المحكمة بعد استيفائه لجميع المعايير الأكاديمية المطلوبة.

نتقدم لكم بأصدق التهاني على هذا الإنجاز العلمي المتميز.

مع فائق الاحترام والتقدير،
```

### مثال 2: نص مع تفاصيل إضافية
```
يسعدنا إبلاغكم بقبول بحثكم للنشر في العدد القادم من مجلتنا العلمية المحكمة.

تم تقييم البحث من قبل محكمين متخصصين، وقد حاز على تقييم ممتاز من حيث الأصالة والمنهجية العلمية.

نتطلع إلى استمرار التعاون العلمي معكم في الأعداد القادمة.

وتفضلوا بقبول فائق الاحترام والتقدير،
```

### مثال 3: نص مختصر
```
تم قبول بحثكم للنشر في مجلتنا بعد مراجعته والموافقة عليه من قبل لجنة التحكيم.

نهنئكم على هذا الإنجاز العلمي.

مع التحية،
```

---

## التنسيق التلقائي

### كيف يعمل:
1. تكتب النص في المحرر (كل فقرة في سطر منفصل)
2. النظام يحول كل سطر إلى `<p>` tag تلقائياً
3. الأسطر الفارغة يتم تجاهلها
4. النتيجة: خطاب منسق بشكل احترافي

### مثال:
**ما تكتبه:**
```
السطر الأول

السطر الثاني

السطر الثالث
```

**ما يظهر في PDF:**
```html
<p>السطر الأول</p>
<p>السطر الثاني</p>
<p>السطر الثالث</p>
```

---

## استكشاف الأخطاء

### المشكلة: النص لا يظهر في الخطاب
**الحل:**
1. تأكد من حفظ الإعدادات
2. تأكد من تشغيل Migration
3. امسح cache المتصفح
4. أعد تحميل الخطاب

### المشكلة: النص يظهر في سطر واحد
**الحل:**
- اضغط Enter بعد كل فقرة
- تأكد من وجود سطر فارغ بين الفقرات

### المشكلة: النص الافتراضي يظهر بدلاً من المخصص
**الحل:**
- تأكد من كتابة النص في الحقل الصحيح
- تأكد من عدم ترك الحقل فارغاً
- احفظ التغييرات

---

## الدعم والمساعدة

إذا واجهت أي مشاكل:
1. تحقق من Console في المتصفح
2. تحقق من logs في Backend
3. تأكد من تشغيل Migration
4. أعد تشغيل Backend والFrontend

---

**تاريخ الإضافة**: 2025-01-11  
**الإصدار**: 1.0.0
