# عرض التعديلات للباحث - دليل التحديث

## 🎯 الهدف

السماح للباحث برؤية التعديلات التي قام بها على بحثه في صفحة عرض البحث، بما في ذلك:
- Timeline كامل لتاريخ البحث
- جميع التعديلات المرسلة
- ملاحظاته حول كل تعديل
- حالة كل تعديل

## 📝 التحديثات المنفذة

### صفحة عرض البحث (ViewResearchPage)

**الملف:** `/apps/frontend/src/pages/dashboard/ViewResearchPage.tsx`

#### التغييرات:
- ✅ إضافة استيراد `researchRevisionsService` و `ResearchTimeline`
- ✅ إضافة state للتعديلات: `revisions`
- ✅ تحميل التعديلات مع بيانات البحث
- ✅ عرض مكون `ResearchTimeline` لعرض تاريخ البحث الكامل
- ✅ عرض قسم "تعديلاتي على البحث" للتعديلات المرسلة
- ✅ إصلاح خطأ TypeScript في `getStatusConfig`

## 🎨 واجهة المستخدم

### صفحة عرض البحث للباحث

```
┌────────────────────────────────────────────────────────────┐
│ عرض البحث                                                 │
│ تطبيقات الذكاء الاصطناعي في التعليم                      │
├────────────────────────────────────────────────────────────┤
│ [← العودة للقائمة]                                        │
├────────────────────────────────────────────────────────────┤
│ 📊 تاريخ البحث                                            │
│ ┌──────────────────────────────────────────────────────┐   │
│ │ 🔵 تقديم البحث - 15 يناير 2024                     │   │
│ │ 🟢 مراجعات المحكمين (2) - 20 فبراير 2024          │   │
│ │ 🟠 طلب تعديلات - المراجعة #1 - 25 فبراير 2024    │   │
│ │ 🟢 إرسال التعديلات - المراجعة #1 - 10 مارس 2024  │   │
│ │ 🟡 في انتظار المراجعات - الآن                     │   │
│ └──────────────────────────────────────────────────────┘   │
├────────────────────────────────────────────────────────────┤
│ 🟢 تعديلاتي على البحث                                    │
│ ┌──────────────────────────────────────────────────────┐   │
│ │ المراجعة #1          📅 10 مارس 2024  ✓ تم الإرسال│   │
│ │                                                      │   │
│ │ ملاحوظاتي حول التعديلات:                           │   │
│ │ ┌──────────────────────────────────────────────┐     │   │
│ │ │ تم إجراء التعديلات التالية:                │     │   │
│ │ │ ✅ تحسين المنهجية البحثية                  │     │   │
│ │ │ ✅ إضافة 15 مرجع حديث                       │     │   │
│ │ │ ✅ إضافة 3 جداول توضيحية                   │     │   │
│ │ │ ✅ مراجعة لغوية شاملة                      │     │   │
│ │ └──────────────────────────────────────────────┘     │   │
│ │                                                      │   │
│ │ 📄 تم رفع ملف جديد                                 │   │
│ └──────────────────────────────────────────────────────┘   │
├────────────────────────────────────────────────────────────┤
│ 📄 تفاصيل البحث                                           │
│ العنوان: تطبيقات الذكاء الاصطناعي...                     │
│ الحالة: 🔵 تحت المراجعة                                  │
│                                                            │
│ ملخص البحث:                                               │
│ [الملخص المعدل الحالي...]                                 │
│                                                            │
│ الكلمات المفتاحية:                                        │
│ 🏷️ ذكاء اصطناعي  🏷️ تعليم  🏷️ تقنية                   │
└────────────────────────────────────────────────────────────┘
```

## 🔄 تدفق العمل

### السيناريو الكامل من منظور الباحث:

```
1. الباحث يقدم البحث
   ↓
   يرى في Timeline: "تقديم البحث ✅"
   
2. المحكمون يراجعون
   ↓
   يرى في Timeline: "مراجعات المحكمين (2) ✅"
   
3. المحرر يطلب تعديلات
   ↓
   يرى في Timeline: "طلب تعديلات - المراجعة #1 ⚠️"
   حالة البحث: "يتطلب تعديل"
   
4. الباحث يعدل البحث
   ↓
   يذهب لصفحة التعديل
   يعدل الملخص والكلمات المفتاحية
   يرفع ملف جديد
   يكتب ملاحظاته
   يرسل التعديلات
   
5. الباحث يفتح صفحة عرض البحث
   ↓
   يرى:
   ✅ Timeline كامل بجميع المراحل
   ✅ قسم "تعديلاتي على البحث"
   ✅ المراجعة #1 مع ملاحظاته
   ✅ حالة "تم الإرسال"
   ✅ البيانات المحدثة (ملخص، كلمات مفتاحية)
   
6. المحكمون يراجعون النسخة المعدلة
   ↓
   يرى في Timeline: "في انتظار المراجعات ⏳"
   
7. بعد اكتمال المراجعات
   ↓
   يرى في Timeline: "مراجعات جديدة ✅"
   
8. القرار النهائي
   ↓
   يرى في Timeline: "قبول البحث ✅" أو "رفض البحث ✖"
```

## 📊 البيانات المعروضة

### 1. Timeline
```typescript
- تقديم البحث (العنوان، التخصص، رقم البحث)
- مراجعات المحكمين (عدد المحكمين، التقييمات)
- طلب تعديلات (التعديلات المطلوبة، الموعد النهائي)
- إرسال التعديلات (تأكيد الإرسال)
- القرار النهائي (قبول/رفض)
```

### 2. قسم التعديلات
```typescript
{
  revision_number: 1,              // رقم المراجعة
  revision_notes: "ملاحظاتي...",  // ملاحظات الباحث
  file_url: "...",                // رابط الملف الجديد
  submitted_at: "2024-03-10",     // تاريخ الإرسال
  status: "submitted"             // الحالة
}
```

### 3. البيانات الحالية
```typescript
{
  title: "العنوان",
  abstract: "الملخص المعدل",
  keywords: ["كلمة1", "كلمة2", "كلمة3"],
  status: "under-review",
  file_url: "رابط الملف الجديد"
}
```

## 🎯 المميزات

### للباحث:
- ✅ **رؤية شاملة**: يرى تاريخ بحثه الكامل في Timeline
- ✅ **تتبع التعديلات**: يرى جميع التعديلات التي أجراها
- ✅ **ملاحظاته محفوظة**: يمكنه مراجعة ما كتبه في كل تعديل
- ✅ **حالة واضحة**: يعرف حالة كل تعديل (معلق/مرسل/مقبول/مرفوض)
- ✅ **تعديلات متعددة**: يرى جميع المراجعات (#1, #2, #3...)

### للنظام:
- ✅ **شفافية كاملة**: الباحث يرى كل شيء
- ✅ **سجل كامل**: جميع التعديلات موثقة
- ✅ **تحسين التواصل**: الباحث يفهم أين وصل بحثه

## 💻 الكود المضاف

### تحميل التعديلات:
```typescript
const [revisions, setRevisions] = useState<ResearchRevision[]>([]);

const loadResearch = async () => {
  const [researchData, filesData, revisionsData] = await Promise.all([
    researchService.getById(id),
    researchService.getFiles(id).catch(() => []),
    researchRevisionsService.getByResearch(id).catch(() => []),
  ]);
  
  setResearch(researchData);
  setFiles(filesData);
  setRevisions(revisionsData);
};
```

### عرض Timeline:
```tsx
<ResearchTimeline 
  research={research} 
  revisions={revisions}
/>
```

### عرض التعديلات:
```tsx
{revisions.filter(r => r.status === 'submitted').length > 0 && (
  <div className="bg-gradient-to-r from-green-50 to-green-100...">
    <div className="p-6 border-b border-green-200">
      <h2>تعديلاتي على البحث</h2>
    </div>
    
    <div className="p-6 space-y-4">
      {revisions
        .filter(r => r.status === 'submitted')
        .sort((a, b) => b.revision_number - a.revision_number)
        .map((revision) => (
          // عرض كل تعديل
        ))}
    </div>
  </div>
)}
```

## 🧪 الاختبار

### خطوات الاختبار:

1. **قدم بحث جديد**
   - افتح صفحة عرض البحث
   - ✅ يجب أن ترى Timeline بحدث "تقديم البحث"
   - ✅ لا يوجد قسم تعديلات (لم يتم طلب تعديلات بعد)

2. **المحرر يطلب تعديلات**
   - افتح صفحة عرض البحث
   - ✅ يجب أن ترى في Timeline "طلب تعديلات"
   - ✅ لا يزال لا يوجد قسم تعديلات (لم ترسل بعد)

3. **قم بالتعديل وأرسله**
   - اذهب لصفحة التعديل
   - عدل الملخص والكلمات المفتاحية
   - اكتب ملاحظاتك
   - ارفع ملف جديد
   - أرسل التعديلات

4. **افتح صفحة عرض البحث**
   - ✅ يجب أن ترى Timeline محدث بـ "إرسال التعديلات"
   - ✅ يجب أن ترى قسم "تعديلاتي على البحث"
   - ✅ يجب أن ترى "المراجعة #1"
   - ✅ يجب أن ترى ملاحظاتك
   - ✅ يجب أن ترى "تم الإرسال"
   - ✅ يجب أن ترى "تم رفع ملف جديد"

5. **إذا طُلبت تعديلات إضافية**
   - كرر العملية
   - ✅ يجب أن ترى "المراجعة #2"
   - ✅ جميع التعديلات مرتبة من الأحدث للأقدم

## 📁 الملفات المعدلة

1. **`/apps/frontend/src/pages/dashboard/ViewResearchPage.tsx`**
   - إضافة state للتعديلات
   - تحميل التعديلات
   - عرض ResearchTimeline
   - عرض قسم التعديلات
   - إصلاح TypeScript error

## 🔗 التكامل مع الصفحات الأخرى

### الصفحات التي تعرض التعديلات الآن:

1. **للباحث:**
   - ✅ `ReviseResearchPage` - صفحة التعديل (مع Timeline)
   - ✅ `ViewResearchPage` - صفحة عرض البحث (مع Timeline)

2. **للمحكم:**
   - ✅ `EvaluationFormPage` - صفحة التقييم
   - ✅ `ReviewDetailsPage` - صفحة تفاصيل المراجعة

3. **للمحرر:**
   - يمكن إضافة نفس العرض في صفحات المحرر إذا لزم الأمر

## ⚠️ ملاحظات مهمة

### 1. Timeline Component
يعرض تاريخ البحث الكامل بشكل تفاعلي وجذاب مع:
- أيقونات ملونة لكل مرحلة
- تفاصيل كل حدث
- إبراز المرحلة الحالية

### 2. التعديلات المتعددة
النظام يدعم تعديلات متعددة ويعرضها جميعاً بترتيب عكسي (الأحدث أولاً).

### 3. الألوان
- 🟢 أخضر للباحث (تعديلاتي)
- 🟠 برتقالي للمحكم (تعديلات الباحث)
- 🔵 أزرق للأحداث العامة

## ✅ الخلاصة

الآن الباحث يمكنه:
- ✅ رؤية تاريخ بحثه الكامل في Timeline
- ✅ رؤية جميع التعديلات التي أجراها
- ✅ مراجعة ملاحظاته حول كل تعديل
- ✅ معرفة حالة كل تعديل
- ✅ تتبع رقم المراجعة والتاريخ

هذا يوفر **شفافية كاملة** للباحث ويساعده على فهم مسار بحثه بوضوح.

---

**تم التطوير بواسطة:** Cascade AI  
**التاريخ:** 2024  
**الإصدار:** 1.0.0
